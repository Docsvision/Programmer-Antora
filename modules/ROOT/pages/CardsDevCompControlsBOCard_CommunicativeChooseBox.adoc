= Элемент управления CommunicativeChooseBox

Элемент управления CommunicativeChooseBox предоставляет функциональность выбора сотрудника из _Справочника сотрудников_. Соответствует элементу управления [.ph .uicontrol]*Сотрудник* _Конструктора разметок_.

image::dev_card_43.PNG[image]

CommunicativeChooseBox содержит следующие функциональные кнопки:

* image:dev_card_43_1.png[image] - флаг состояния выбранного сотрудника в Microsoft Lynс Server. Открывает окно отправки сообщения сотруднику;
* [.ph .uicontrol]*...* - открывает окно выбора сотрудника;
* [.ph .uicontrol]*X* - очищает результат выбора сотрудника.

[NOTE]
====
[.note__title]#Прим.:# Связь с сотрудником возможна только при наличии на компьютере пользователя установленного MS Lynс.
====

CommunicativeChooseBox обладает следующими свойствами:

* AccountName - учетная запись выбранного сотрудника.
* ActiveControl.Text - позволяет получить имя сотрудника, отображенное на элементе управления.
* ContactLoaded - признак доступности сотрудника в сети Lynс.
* HideNotAvailable - при значении true (значение по умолчанию) из быстрого поиска будут скрыты сотрудники с флагом 'Не показывать при выборе', установленным в _Справочнике сотрудников_.
* ObjectContext - _контекст объектов_. Элемент управления CommunicativeChooseBox требует ручной передачи _контекста объектов_, к примеру, при инициализации карточки
+
[source,csharp]
----
protected override void OnCardInitialized(EventArgs e)
{
 base.OnCardInitialized(e);
 InitializeComponent();

 this.communicativeChooseBox.ObjectContext = this.ObjectContext; // Передача контекста объектов
}
----
* SearchIndex - определяет минимальное количество символов в строке поиска, при котором будет выполнен быстрый поиск с отображением результатов.
* Value - идентификатор выбранного сотрудника.
* ValueResolved - значение true символизирует завершение выбора сотрудника.

CommunicativeChooseBox предоставляет следующие основные методы:

* ChooseValue() - вызывает окно выбора сотрудника.
* GetValue<T>() - возвращает объект c идентификатором `Value`, приведенный к указанному типу [.keyword .apiname]#T#. Например, после выбора сотрудника (из списка или окна поиска), его объектная модель может быть получена следующим образом:
+
[source,csharp]
----
private void GetSelectedEmployee_Click(object sender, EventArgs e)
{
 var employee = this.communicativeChooseBox.GetValue<DocsVision.BackOffice.ObjectModel.StaffEmployee>();
}
----
* SetValue(ObjectBase) - переданный объект будет записан в результат выбора сотрудника. Данный метод может быть использован, если необходимо программно задать значение выбора сотрудника; в текстовое поле поиска будет записано отображаемое имя сотрудника.

CommunicativeChooseBox разрешает подписку на следующие события:

* CustomChoosingValue - событие срабатывает при нажатии кнопки выбора сотрудника.
* EmployeeChanged - событие срабатывает после выбора сотрудника.
* ButtonClick - нажатие кнопки очистки строки поиска.
* CustomizeSearchQuery - событие срабатывает при выполнении быстрого поиска. Обработка события позволяет изменить поисковый запрос, результаты которого отображаются при вводе текста.
+
Следует обратить внимание, что событие CustomizeSearchQuery вызывается не каждый раз при вводе символов, а только при обращении к серверу Docsvision. При первом обращении результаты помещаются в локальный кэш, время жизни которого – 5 секунд. Если следующий поисковый запрос основан на текущем и кэш не старше 5 секунд, то обращений к серверу не будет и событие CustomizeSearchQuery не сработает ( результаты будут выбраны из кэша).

В качестве примера использования данного элемента управления, демонстрация фамилии сотрудника, подготовившего документ:

[source,csharp]
----
ICustomizableControl customizable = CardControl;

// Получение элемента управления "Подготовил"
CommunicativeChooseBox regControl = customizable.FindPropertyItem<CommunicativeChooseBox>("Registrar");

if (regControl != null && regControl.Value != Guid.Empty)
{
 // Возвращаем данные сотрудника
 StaffEmployee employee = CardControl.ObjectContext.GetObject<StaffEmployee>(regControl.Value);
 MessageBox.Show(string.Format("Фамилия: {0}, имя: {1}", employee.LastName, employee.FirstName));
}
----
