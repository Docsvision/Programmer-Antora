= Раздел 'Virtual fields'

После описания секций и полей карточки можно переходить к описанию _виртуальных полей_. Виртуальные поля представляют собой правила для формирования данных, которые физически не хранятся в самой карточке, но могут быть интересны при построении представлений (отчётов) с участием карточек такого типа.

В качестве источника данных для виртуального поля могут выступать:

* физическое поле самой карточки;
* физическое поле карточки другого типа, которая по каким-то признакам связана с данной;
* системные данные о карточке (например, дата последнего изменения);
* результат вычислений, произведённых над любым из вышеперечисленных полей.

[NOTE]
====
[.note__title]#Прим.:# Виртуальные поля, определённые в схеме карточки, будут всегда доступны в рамках соответствующих секций в диалоге настройки представлений. Помимо этого, пользователи смогут самостоятельно доопределить дополнительные виртуальные поля уже в процессе работы с системой.
====

Для создания нового виртуального поля нужно перейти в раздел [.keyword .wintitle]*Virtual fields* и выбрать соответствующий пункт контекстного меню.

image::dev_card_11.png[[.fig--title-label]##Рис. 1. ##Свойства виртуального поля]

Основные свойства виртуального поля:

* [.ph .uicontrol]*Псевдоним* – псевдоним виртуального поля, с помощью которого к нему можно обращаться в коде. Псевдоним должен быть уникальным в рамках карточки;
* [.ph .uicontrol]*Названия* – локализованные названия виртуального поля, отображаемые у пользователя (в диалоге настройки представлений);
* [.ph .uicontrol]*Description*– словесное описание виртуального поля, будет отображаться в виде подсказки к полю в диалогах поиска и представлений;
* [.ph .uicontrol]*Идентификатор* – уникальный идентификатор виртуального поля;
* [.ph .uicontrol]*Тип* – результирующий тип данных виртуального поля. Доступны только простые типы:
** *int* -- целое;
** *bool* -- булевское значение;
** *datetime* -- дата и время;
** *uniqueid* -- уникальный идентификатор (GUID);
** *string* -- строка;
** *unistring* -- строка в формате Unicode;
** *float* -- число с плавающей точкой;
** *unitext* -- текст в формате Unicode;
** *decimal* -- десятичное число;
** *binary* -- двоичные данные;
* Идентификатор секции, на основе данных которой строится виртуальное поле. Из этой секции будут выбираться физические поля для вычислений, и к ней будут последовательно присоединяться другие секции или таблицы;
* [.ph .uicontrol]*Определение поля* – источник данных для виртуального поля. Доступные источники:
** *Поле секции* – физическое поле основной или присоединённой секции;
** *Вычисляемое поле* – правила вычислений над физическим полем основной или присоединённой секции;
* [.ph .uicontrol]*Присоединенные разделы* – позволяет определить связи основной секции виртуального поля с другими секциями или таблицами. Секции связываются между собой по определённому полю (обычно -- уникальному идентификатору).

image::dev_card_12.png[[.fig--title-label]##Рис. 2. ##Присоединение секции]

При присоединении секции, необходимо указать следующие значения:

* [.ph .uicontrol]*Alias* – уникальный (в рамках определения виртуального поля) псевдоним присоединяемой секции;
* [.ph .uicontrol]*Source section* – секция, к которой производится присоединение (основная секция виртуального поля или ранее присоединенная);
* [.ph .uicontrol]*Source field* – поле оригинальной секции, по которому производится присоединение (JOIN);
* [.ph .uicontrol]*Target section* – секция другой карточки или системная таблица;
* [.ph .uicontrol]*Target field* – поле присоединяемой секции, по которому производится JOIN;
* [.ph .uicontrol]*Conditions* – условия фильтрации записей присоединённой секции;

После присоединения всех необходимых секций можно задать правила построения вычисляемых полей. Для чего кликните по кнопке [.ph .uicontrol]*Изменить* в блоке настроек поля.

image::dev_card_13.png[[.fig--title-label]##Рис. 3. ##Свойства вычисляемого поля]

Описание вычисляемого поля по сути представляет собой совокупность атомарных операций (элементов), выполняющихся в определённом порядке, который задаётся через иерархические группы. Внутри каждой группы элементы могут объединяться арифметической операцией (+,-,*,/), логической операцией (AND, OR) или агрегацией.

[NOTE]
====
[.note__title]#Важное замечание:# Вычисления одного уровня исполняются строго последовательно, поэтому важно контролировать порядок их выполнения. Для этого можно перемещать элементы внутри группы кнопками [.ph .uicontrol]*Up* и [.ph .uicontrol]*Down*.
====

Каждый элемент вычислений, в свою очередь, может быть одним из следующих видов:

* *Simple* -- значение физического поля секции, предопределённое значение или результат применения к нему простейшей функции; +
image:dev_card_14.png[image] +
* *Switch* – результат селекции, сопоставляющей конкретным данным физического поля предопределённые значения; +
image:dev_card_15.png[image] +
* *Conditions* -- условный оператор, формирующий значение элемента в зависимости от значений других элементов. +
image:dev_card_16.png[image] +

[NOTE]
====
[.note__title]#Внимание:# Важно контролировать типы конкретных элементов вычислений и их групп, чтобы избежать ошибок в вычислениях и получить правильный тип результирующего значения.
====

== См. далее

* xref:CardsDevDataSchemeUploadBase.adoc[Загрузка схем карточек в базу данных]
