= Создание карточки учета перемещения техники

В данном примере будет рассмотрен практический пример создания карточки для учета перемещений техники. В основе карточки будет использоваться стандартный компонент карточки библиотеки "Базовые объекты".

[NOTE]
====
[.note__title]#Прим.:# Архив готовой библиотеки карточек, приведенной в данном примере, доступен по xref:../examples/cardLibrary.zip[ссылке].
====

== Разработка схемы данных

Прежде всего необходимо определить архитектуру будущей карточки - это будет отдельная карточка для каждой единицы техники, содержащая название и список перемещений (дата перемещения, ответственный сотрудник, подразделение-получатель и примечание).

[NOTE]
====
[.note__title]#Прим.:# Данный пример рассчитан на специалиста, знакомого с методикой разработки схемы карточки и библиотеки карточек. Для получения данной информации обратитесь к разделу link:CardsDevDataScheme.adoc[Разработка схемы данных карточки].
====

. Создайте новую библиотеку карточек с использованием утилиты [.dfn .term]_Docsvision CardManager_.
+
В данном случае в параметрах библиотеки достаточно указать [.ph .uicontrol]*Alias* и [.ph .uicontrol]*Названия*.
+
image::img/SC_CreateCard1.PNG[image]
. Создайте в данной библиотеке новую карточку.
+
Для карточки требуются следующие изменения:
* Укажите [.ph .uicontrol]*Псевдоним* и [.ph .uicontrol]*Названия*.
* В поле [.ph .uicontrol]*Строка активации* введите значение "clsid:\{16f0201f-589f-465c-9721-f6a571eb9512}" - идентификатор компонента xref:../api/DocsVision/BackOffice/WinForms/BaseCardControl_CL.adoc[BaseCardControl].
* В поле [.ph .uicontrol]*Имя типа* укажите значение "DocsVision.BackOffice.WinForms.BaseCardControl, DocsVision.BackOffice.WinForms, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7148afe997f90519" - полное название класса, являющегося основной для создаваемой карточки и карточек библиотеки "Базовые объекты".
* В списке [.ph .uicontrol]*Режим чтения данных* выберите значение [.keyword]*FETCH_CARD* - данные карточки будут получены клиентом полностью.
* Установите флажки [.ph .uicontrol]*Card can be marked as template* и [.ph .uicontrol]*Instances can be copied*.
+
image::img/SC_CreateCard2.PNG[image]
. Добавьте в карточку секцию "MainInfo" - базовая информация об единице техники.
+
Для данной секции произведите следующие изменения:

* Указать [.ph .uicontrol]*Названия*.
* Выбрать тип организации данных (список [.ph .uicontrol]*Тип*) в секции "struct".
+
image::img/SC_CreateCard3.PNG[image]
+
В данную секции добавьте поле Name с типом unitext. Данное поле будет представлять название отдельной единицы оборудования.
+
image::img/SC_CreateCard4.PNG[image]
. Добавьте в карточку секцию "History" - содержит историю перемещения техники.
+
Для данной секции произведите следующие изменения:

* Указать [.ph .uicontrol]*Названия*.
* Выбрать тип организации данных (список [.ph .uicontrol]*Тип*) в секции "table" (для возможности хранения нескольких элементов).

image::img/SC_CreateCard5.PNG[image]
+
В данную секцию требуется добавить следующие поля:

* Employee с типом refid, в котором содержится ссылка на сотрудника, выполнившего перемещение техники. В свойствах поля необходимо указать идентификаторы в полях [.ph .uicontrol]*Тип, куда ссылаемся (ID)* (идентификатор [.dfn .term]_Справочника сотрудников_) и [.ph .uicontrol]*Раздел, куда ссылаемся (ID)* (идентификатор секции [.dfn .term]_Сотрудники_). Дополнительно можно установить флажок [.ph .uicontrol]*Обязательное*.
+
image::img/SC_CreateCard6.PNG[image]
* Date с типом date. Данное поле содержит дату перемещения оборудования.
+
image::img/SC_CreateCard7.PNG[image]
* Recipient с типом refid, в котором содержится ссылка на организацию/подразделение. В свойствах поля необходимо указать идентификаторы в полях [.ph .uicontrol]*Тип, куда ссылаемся (ID)* (идентификатор [.dfn .term]_Справочника сотрудников_) и [.ph .uicontrol]*Раздел, куда ссылаемся (ID)* (идентификатор секции [.dfn .term]_Подразделения_). Дополнительно можно установить флажок [.ph .uicontrol]*Обязательное*.
+
image::img/SC_CreateCard8.PNG[image]
* Description с типом string. Тестовый комментарий к операции перемещения техники.
+
image::img/SC_CreateCard9.PNG[image]
. Добавить в карточку секции System, Numbers и Processes. Данные секции являются типовыми и могут быть скопированы (операции Copy и Paste из контекстного меню) из схемы карточки типа [.dfn .term]_Документ_ библиотеки [.dfn .term]_Базовые объекты_. Если секции создаются методом копирования, необходимо изменить псевдоним секции на начальное значение.

После создания схемы, библиотека карточек должна быть загружена на сервер Docsvision (см. раздел xref:CardsDevDataSchemeUploadBase.adoc[Загрузка схем карточек в базу данных]).

[NOTE]
====
[.note__title]#Важное замечание:# После добавления карточки потребуется перезапуск сервиса Docsvision или перезагрузка сервера
====

== Установка параметров карточки в конструкторах

После добавления карточки в базу Docsvision необходимо произвести дополнительную настройку карточки при помощи конструкторов Docsvision.

. В [.dfn .term]_Справочнике видов карточек_ откройте созданную библиотеку и карточку и проверите соответствие настроек представленному ниже изображению (название карточки и библиотеки может отличаться). Сохраните изменения.
+
image::img/SC_CreateCard10.PNG[image]
. В [.dfn .term]_Конструкторе разметок_ определите минимум одно состояние, которое будет являться начальным, а также установите доступность операций редактирования.
+
image::img/SC_CreateCard11.PNG[image]
. В [.dfn .term]_Конструкторе ролей_ определите роль для карточки (например, Все).
+
image::img/SC_CreateCard12.PNG[image]
+
Установите необходимый уровень доступа для роли к операциям с карточкой в разделе [.keyword .wintitle]*Матрица доступа*.
+
image::img/SC_CreateCard13.PNG[image]
. В [.dfn .term]_Конструкторе разметок_ требуется создать разметку, соответствующую содержимому карточки.
+
image::img/SC_CreateCard14.PNG[image]
+
[.ph .uicontrol]*Название* - элемент управления типа [.dfn .term]_Строка_, [.ph .uicontrol]*Источником данных* для которого установлена секция [.dfn .term]_Основная информация_, а [.ph .uicontrol]*Поле данных* - [.dfn .term]_Название_.

image::img/SC_CreateCard15.PNG[image]

В качестве элемента управления [.ph .uicontrol]*Перемещение* используется [.dfn .term]_Таблица_, у которой [.ph .uicontrol]*Источником данных* установлена секция [.dfn .term]_История перемещения_.

image::img/SC_CreateCard16.PNG[image]

Для данного элемента управления необходимо добавить столбцы: [.dfn .term]_Дата_, [.dfn .term]_Сотрудник_, [.dfn .term]_Получатель_ и [.dfn .term]_Примечание_. В каждом столбце выбирается соответствующий элемент данных.

image::img/SC_CreateCard17.PNG[image]

После сохранения всех настроек появится возможность создать экземпляр новой карточки и заполнить ее данными.

image::img/SC_CreateCard18.PNG[image]

*На уровень выше:* xref:../pages/samples_container_createcomponents.adoc[Примеры реализации компонента карточек, библиотек карточек и расширений]
