= Обновление решения

Обновление _решения_, созданного на платформе {dv} включает два этапа:

. Обновление серверной части.
. Обновление клиентской части.

== Обновление серверной части

Для того, чтобы серверная часть могла обновиться, что включает удаление старой версии и установку новой, достаточно изменить идентификатор продукта (атрибут "Id" ) в проекте пакета установки серверной части, либо использовать значение "*" в атрибута "Id" этого проекта.

Естественно в проект должны быть загружены новые компоненты, а также новый пакет установки клиентской части.

== Обновление клиентской части

Обновление клиентской части выполняется автоматически при условии, что:

* библиотека карточек имеет новую версию;
* пакет установки клиентской части имеет новый _код продукта_ и поддерживает обновление.

Для этого:

. Увеличиваем номер версии библиотеки карточек в xref:CreateCardLib_SchemaLib.adoc[схеме метаданных библиотеки]:
+
image::CardManager4.png[image]
. Изменяем номер версии библиотеки в xref:CreateCardLib_LibControl.adoc[компоненте библиотеки] (файл `dvver.h`) на номер, указанный в схеме метаданных:
+
[source,pre,codeblock]
----
#define VERSION_MAJOR                       5
#define VERSION_MINOR                       0
#define VERSION_BUILD             2018
#define VERSION_REVISION                    0
#define VERSION_DISPLAY_MINOR               2
----
. Устанавливаем в схеме метаданных библиотеки карточек новый [.kbd .ph .userinput]`Код продукта`:
+
image::CardManager5.png[image]
. Изменяем _код продукта_ в проекте расширения _Консоли настройки_, в методе Execute (см. раздел xref:CreateSnapIn_Interface.adoc[Реализация стандартных интерфейсов]) на значение, использованное в схеме метаданных:
+
[source,csharp]
----
public bool Execute()
{
 /* часть кода пропущена */
 
 cardLibConfig.RegisterPackage(
  "E98E531F-D34C-41D6-9BCA-9972F46EB6DF", // Идентификатор пакета установки
  "22CE4047-0BA8-4014-9BBE-7D8C43FDE904", // Код продукта
  Path.Combine(AssemblyFolder, "NetstatSolutionClient.msi"));

 return true;
}
----
. Изменяем значение *Product Id* в xref:CreateInstaller_Client.adoc[проекте пакета установки клиентской части] (файл Product.wxs), используя _код продукта_ из схемы метаданных:
+
[source,pre,codeblock]
----
<Product Id="22CE4047-0BA8-4014-9BBE-7D8C43FDE904" 
 Name="NetstatSolutionClient"
 Language="1049"
 Version="$(var.ProductVersion)"
 Manufacturer="Docsvision"
 UpgradeCode="$(var.UpgradeCode)">
----

В итоге, при запуске пакета установки, серверная часть будет обновлена до новой версии, а клиентская часть обновиться автоматически при запуске _Docsvision Windows-клиент_.

