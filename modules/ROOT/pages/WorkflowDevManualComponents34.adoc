= Сохранение сценария в виде сборки

Начиная с версии Docsvision 4.5 в [.dfn .term]_функцию_ "Сценарий" добавлена возможность компиляции кода для получения готовой сборки (DLL), которую можно повторно использовать в бизнес-процессах. Последовательность получения сборки следующая:

. Создайте новый бизнес-процесс или используйте имеющийся.
. Добавьте в [.dfn .term]_бизнес-процесс_ функцию "Сценарий".
+
image::img/build_script.PNG[image]
. В [.dfn .term]_сценарии_ напишите скрипт, который будет содержать необходимую функциональность и будет соответствовать следующим требованиям:
[loweralpha]
.. Должен содержать минимум один публичный (publiс) класс.
.. Должны присутствовать публичные статические (public static) методы. В рамках одного [.dfn .term]_сценария_ возможно наличие произвольного числа таких методов – каждый из них будет выступать как отдельная [.dfn .term]_функция_ в "Универсальной функции".
+
[NOTE]
====
[.note__title]#Важное замечание:# Аргументы данного метода, также как и возвращаемое значение (если предусмотрено) должны иметь тип, реализованный шлюзами Workflow (включая шлюз к базовым типам).
====
+
Ниже приведен пример скрипта, в котором доступен один метод [.keyword .apiname]#SaveCard#, подразумевающий выполнение действий над переданной карточкой `card`.
+
[source,pre,codeblock,language-csharp]
----
// Подключение системных библиотек
using System;
using System.Xml;
using System.ComponentModel;

// Подключение библиотек СУБП
using DocsVision.Workflow.Gates;

namespace SampleCode
{ 
 public class SampleFunc
 {
  public static void SaveCard(DVCard card)
  {
    // Выполнение действие с объектом card

  }
 }
}
----
. Выполните проверку корректности скрипта (кнопка [.ph .uicontrol]*Компилировать*).
. В том случае, если ошибок при компиляции не обнаружено, нажмите [.ph .uicontrol]*Создать сборку*. Система предложит выбрать место для сохранения библиотеки. Нужно учитывать, что итоговая сборка должна быть доступна сервису Workflow, для этого ее достаточно поместить в каталог приложения Workflow (исполняемый файл [.ph .filepath]`ExecLogic.exe`), либо зарегистрировать в GAC.
. Выполните сохранение, нажмите [.ph .uicontrol]*OK*.

Ссылка на сборку будет автоматически добавлена в список сборок Workflow (справочника [.dfn .term]_Системных настроек_). Это позволит в дальнейшем использовать данный [.dfn .term]_сценарий_ в других процессах в виде [.dfn .term]_функции_, без необходимости копирования его исходного кода.

Для того, чтобы обратиться к методам полученной сборки:

. Создайте новый бизнес-процесс или используйте имеющийся.
. Добавьте в процесс [.dfn .term]_функцию_ "Универсальная функция".
. Выберите Тип. При выборе ориентируйтесь на название сборки, созданной ранее. В качестве типа может быть выбран один из классов, реализованных в скрипте.
. Выберите Функцию. Для выбора доступны статические публичные методы класса, выбранного ранее.
. При необходимости указать значения Параметров функции. Параметры функции соответствую параметрам выбранного метода.
. Сохраните настройки ([.ph .uicontrol]*ОК*).
+
image::img/build_script_3.PNG[image]

Для того, чтобы реализованные классы и методы имели локализованное название, при отображении в окне параметров "Универсальной функции", пометьте эти сущности специальным атрибутом [.keyword .apiname]#ResName#

[source,pre,codeblock,language-csharp]
----
// Подключение системных библиотек
using System;
using System.Xml;
using System.ComponentModel;

// Подключение библиотек СУБП
using DocsVision.Workflow.Gates;

namespace SampleCode
{ 
 [ResName("Пример функции")]
 public class SampleFunc
 {
  [ResName("Пример метода функции")]
  public static void SaveCard([ResName("Переменная")] DVCard card)
  {
    // Выполнение действие с объектом card

  }
 }

 // internal sealed class ResNameAttribute : DescriptionAttribute 
}
----

Класс [.keyword .apiname]#ResNameAttribute# требуется реализовать самостоятельно по следующему примеру

[source,pre,codeblock,language-csharp]
----
[System.AttributeUsage(System.AttributeTargets.All)]
internal sealed class ResNameAttribute : DescriptionAttribute 
{ 
 public ResNameAttribute(string name) : base(name) { }
}
----

Данный класс может быть включен в сборку с получаемым [.dfn .term]_сценарием_, либо вынесен в отдельную библиотеку.

После получения библиотеки с локализованными названиями, окно настройки "Универсальной функции" будет как показано ниже.

image::img/build_script_2.PNG[image]

Помимо сборок, созданных на базе [.dfn .term]_сценариев_, возможно подключение в таком качестве любых произвольных сборок, отвечающих тем же требованиям. Данные библиотеки должны быть самостоятельно зарегистрированы в качестве модуля Workflow. Регистрация осуществляется в категории "Настройки Workflow/Сборки" справочника "Системные настройки" (папка "Конструкторы и справочники") приложения [.keyword]*Docsvision Windows-клиент*. Сборка должна быть доступна сервису Workflow (см. выше).

*На уровень выше:* xref:../pages/WorkflowDevManualComponents3.adoc[Сценарии]
