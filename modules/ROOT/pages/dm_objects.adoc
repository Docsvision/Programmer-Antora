= Объекты хранения данных

Ключевым объектом Docsvision, соответствующим сущностям целевой системы, является [.dfn .term]_карточка_. С карточками работают как пользователи, так и разработчики, но если для пользователя карточка - это прежде всего графический интерфейс, на который определенным образом выведены данные, то для разработчика - это объектная модель, метаданные и собственно данные.

Прежде чем перейти к дальнейшему описанию определим несколько ключевых понятий:

* [.dfn .term]_Тип карточки_ - описание сущности целевой системы в Docsvision. Если проводить аналогию с программированием, то тип карточки - это класс.
+
[NOTE]
====
[.note__title]#Прим.:# В Docsvision достаточно много типов карточек (см. раздел xref:DM_StandartCards.adoc[Описание полей стандартной карточки]). Если существующие типы недостаточно точно отражают объект целевой системы, то может быть разработан собственный с уникальной бизнес-логикой (см. xref:dm_developmentcards.adoc[Разработка карточек и библиотек карточек]).
====
* [.dfn .term]_Экземпляр карточки_ - экземпляр карточки определенного типа. Экземпляр карточки обладает уникальным идентификатором, по которому карточка может быть получена из базы данных. Если следовать аналогии, то экземпляр карточки - это объект.
* [.dfn .term]_Поле_ - элемент структуры карточки, предназначенный для непосредственного хранения данных определенного типа. Также может ссылаться на другие элементы данной или другой карточки.
* [.dfn .term]_Секция_ - элемент структуры карточки, объединяющий группу полей.

С точки зрения метаданных, карточка - это набор [.dfn .term]_секций_ с коллекциями [.dfn .term]_полей_. Каждая секция карточки обладает собственным набором полей, что обеспечивает необходимый уровень гибкости для реализации структур хранения данных.

[NOTE]
====
[.note__title]#Прим.:# На уровне базы данных секция - это таблица, а поле - это столбец данной таблицы.
====

Конкретный набор секций и полей, а также их характеристики определяет [.dfn .term]_схема карточки_. Каждый тип карточек обладает собственной схемой, что позволяет реализовать в системе объекты, приближенные по характеристикам к сущностям выбранной предметной области. К примеру, для хранения информации о книгах библиотеки, может быть реализована карточка типа "Книга" с полями: название, автор, дата издания и т.п.; а для хранения информации о входящих документах компании можно реализовать типа "Входящий документ" с полями: отправитель, дате отправки, специалист, который должен получить данный документ.

На уровне экземпляра карточки (конкретного документа, задания и т.п.) наборы данных хранятся не просто в полях секций карточки, а в полях подчиненных по отношению к секциям сущностях - [.dfn .term]_строках_ секций. Строки обеспечивают возможность хранения в одной секции коллекции наборов данных, в т.ч. с определенной иерархией. Это может быть востребовано, к примеру, если в карточке типа "Книга" должны храниться сведения о нескольких авторах этой книги. Помимо табличного варианта организации строк секции, предусмотрена иерархическая структура, при которой строка секции может содержать подчиненные строки из этой же секции. Такая структура секции обычно используется в справочниках - карточки, представленные в единственном экземпляре (ограничение устанавливается схемой карточки), данные из которых используются в других карточках. Примером справочника может служить [.dfn .term]_Справочник сотрудников_ из библиотеки карточек "Базовые объекты", данные которого используются во многих других типах карточек данной библиотеки.

Структура секции определяются её типом:

* Плоская секция - может содержать только одну строку. Создание второй строки будет воспринято как ошибка.
* Коллекционная секция - может содержать набор строк. Секция данного типа по сути аналогична обычной таблице.
* Иерархическая секция - может содержать иерархию строк, в которой строка может иметь в подчинении строки этой же секции.

[NOTE]
====
[.note__title]#Прим.:# На уровне базы данных секция строка секции - это строка таблицы, а секция - сама таблица.
====

Далее, для обобщения изложенной выше информации, представлена структура экземпляра карточки некого типа. Подобную структуру можно составить на основе данных, предоставляемых программой «Docsvision Explorer» из комплекта «Resource Kit».

image::img/data_struct.png[image]

Приведенную карточку (в сочетании со схемой типа карточки) можно охарактеризовать следующим образом:

* Карточка содержит две секции: Секция "A" (иерархическая) и Секция "B" (плоская).
* Секция "A" содержит две строки: Строка 1 и Строка 2. У Строки 1 есть подчиненная строка - Подстрока 1. В секции определено два поля: Поле 1 и Поле 2.
* Секция "B" содержит единственную строку (Строка 1), что определено ограничениями плоской секции. В секции определены поля: Поле 1, Поле 2 и Поле 3.
* Секция "B" также имеет подчиненную секцию - Подсекция "С" (коллекционная), которая содержит две строки: Строка 1 и Строка 2. В секции определено единственное поле - Поле 1.

Для представления данных карточки в API Docsvision реализовано несколько классов, специфичных для выбранного уровня (слоя) API. Далее приведены такие типы для обоих уровней API Docsvision.

== Объекты хранения данных на уровне базового API

[NOTE]
====
[.note__title]#Прим.:# Типы, приведенные далее, определены в сборке [.ph .filepath]`DocsVision.Platform.ObjectManager.dll`.
====

* xref:../api/DocsVision/Platform/ObjectManager/CardData_CL.adoc[CardData] - данные экземпляра карточки. Включает совокупность всех данных секций и атрибутов конкретного экземпляра карточки.
* xref:../api/DocsVision/Platform/ObjectManager/SectionData_CL.adoc[SectionData] - данные секции карточки, из которой может быть получена коллекция всех её строки.
* xref:../api/DocsVision/Platform/ObjectManager/RowDataCollection_CL.adoc[RowDataCollection] - коллекция строк секции, из которой могут быть выбраны конкретные строки.
+
[NOTE]
====
[.note__title]#Прим.:# Если коллекция получена непосредственно из карточки, то она считается "живой", т.е. при создании/удалении строки изменения в коллекции будут видны сразу же. Если коллекция получена поисковым запросом, то она является "моментальным снимком" данных, доступным только на чтение.
====
* xref:../api/DocsVision/Platform/ObjectManager/RowData_CL.adoc[RowData] - строка секции. Выбрать строку из коллекции строк можно по уникальному идентификатору или по номеру в коллекции, либо перебором.
* xref:../api/DocsVision/Platform/ObjectManager/SubSectionData_CL.adoc[SubSectionData] - подмножество строк (подсекция) секции, подчинённых определённой строке из родительской секции.
* xref:../api/DocsVision/Platform/ObjectManager/Metadata/Field_CL.adoc[Field] - поле строки секции, а точнее его значение.

Обычный сценарий доступа к данным карточки с привлечением приведенных типов следующий:

. Получить экземпляр карточки - [.keyword .apiname]#CardData#.
. Получить нужную секцию из карточки: [.keyword .apiname]#CardData.Sections[Section_ID]#.
. Получить коллекцию строк выбранной секции: [.keyword .apiname]#SectionData.Rows#.
. Выбрать конкретную строку из секции: [.keyword .apiname]#SectionData.Rows[Row_ID]#.
. Получить значение поля по псевдониму: [.keyword .apiname]#RowData[FieldAlias]#

== Объекты хранения данных на уровне объектной модели

[NOTE]
====
[.note__title]#Прим.:# Типы, приведенные далее, определены в сборках: [.ph .filepath]`DocsVision.BackOffice.ObjectModel.dll` (содержит типы, описывающие сущности карточки) и [.ph .filepath]`DocsVision.Platform.ObjectModel.dll` (содержит общие базовые классы).

[NOTE]
====
[.note__title]#Важное замечание:# Приведенные далее сведения относятся только к карточкам, объектная модель которых унаследована от базового класса xref:../api/DocsVision/BackOffice/ObjectModel/BaseCard_CL.adoc[BaseCard]. Если объектная модель создана на основе базовых классов из сборки [.keyword .apiname]#DocsVision.Platform.ObjectModel.dll#, то механизм доступа к данным будет отличаться.
====

Объектная модель карточки предлагает гораздо меньшее (в сравнении с базовым API) число типов:
====

* [.keyword .apiname]#BaseCard# - базовый класс карточки, который содержит коллекции всех строк ей секций.
* xref:../api/DocsVision/BackOffice/ObjectModel/BaseCardSectionRow_CL.adoc[BaseCardSectionRow] - строка секции, предоставляющая доступ к своим полям.

Как видно из списка, в объектной модели нет отдельных классов для секций и полей, что несколько упрощает сценарий доступа к данным, который в общем случае будет следующий:

. Получить экземпляр карточки - тип [.keyword .apiname]#BaseCard#, либо унаследованный от него.
. Выбрать строки конкретной секции, воспользовавшись методом [.keyword .apiname]#BaseCard.GetSection#.
. Выбрать строку из полученной коллекции.
. Получить значение нужного поля по его псевдониму: BaseCardSectionRow["FieldAlias"].

Если для типа карточки была реализована собственная объектная модель, то обращение к данным карточки будут выглядеть еще проще:

. Получить экземпляр карточки, к примеру, типа SampleCard - унаследован от типа [.keyword .apiname]#BaseCard#.
. Получить коллекцию строк секции, из соответствующего публичного свойства класса: SampleCard.SampleSection.
. Выбрать нужную строку секции: SampleCard.SampleSection[0]. Если секция является плоской и это учтено при реализации объектной модели, то данный шаг пропускается.
. Получить значение поля: SampleCard.SampleSection[0].SampleField.

Помимо типов, приведенных выше и относящихся к доступу к данным карточки, в процессе разработки типов могут быть задействованы дополнительные типы, к примеру, относящиеся к справочникам. Если такие типы будут использованы далее, то будет приведено их описание. Также описание большинства типов API Docsvision приведено в разделе xref:../api/Intro.adoc[Библиотека классов].

== См. также

* xref:dm_connection.adoc[Подключение к серверу Docsvision]

*На уровень выше:* xref:../pages/dm_generalinformation.adoc[Общие сведения]
