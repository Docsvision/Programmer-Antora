= Создание карточки учета перемещения техники

В данном примере будет рассмотрен практический пример создания карточки для учета перемещений техники. В основе карточки будет использоваться стандартный компонент карточки библиотеки _{bo}_.

[NOTE]
====
Архив готовой библиотеки карточек, приведенной в данном примере, доступен по xref:attachment$cardLibrary.zip[ссылке].
====

== Разработка схемы данных

Прежде всего необходимо определить архитектуру будущей карточки -- это будет отдельная карточка для каждой единицы техники, содержащая название и список перемещений (дата перемещения, ответственный сотрудник, подразделение-получатель и примечание).

[NOTE]
====
Данный пример рассчитан на специалиста, знакомого с методикой разработки схемы карточки и библиотеки карточек. Для получения данной информации обратитесь к разделу xref:solutions/cards/scheme/dev-data-scheme.adoc[Разработка схемы данных карточки].
====

. Создайте новую библиотеку карточек с использованием утилиты _Docsvision CardManager_.
+
В данном случае в параметрах библиотеки достаточно указать *Alias* и *Названия*.
+
image::SC_CreateCard1.PNG[image]
. Создайте в данной библиотеке новую карточку.
+
Для карточки требуются следующие изменения:
* Укажите *Псевдоним* и *Названия*.
* В поле *Строка активации* введите значение "clsid:\{16f0201f-589f-465c-9721-f6a571eb9512}" -- идентификатор компонента xref:api/DocsVision/BackOffice/WinForms/BaseCardControl_CL.adoc[BaseCardControl].
* В поле *Имя типа* укажите значение "DocsVision.BackOffice.WinForms.BaseCardControl, DocsVision.BackOffice.WinForms, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7148afe997f90519" -- полное название класса, являющегося основной для создаваемой карточки и карточек библиотеки _{bo}_.
* В списке *Режим чтения данных* выберите значение *FETCH_CARD* -- данные карточки будут получены клиентом полностью.
* Установите флажки *Card can be marked as template* и *Instances can be copied*.
+
image::SC_CreateCard2.PNG[image]
. Добавьте в карточку секцию "MainInfo" -- базовая информация об единице техники.
+
Для данной секции произведите следующие изменения:

* Указать *Названия*.
* Выбрать тип организации данных (список *Тип*) в секции "struct".
+
image::SC_CreateCard3.PNG[image]
+
В данную секции добавьте поле Name с типом unitext. Данное поле будет представлять название отдельной единицы оборудования.
+
image::SC_CreateCard4.PNG[image]
. Добавьте в карточку секцию "History" -- содержит историю перемещения техники.
+
Для данной секции произведите следующие изменения:

* Указать *Названия*.
* Выбрать тип организации данных (список *Тип*) в секции "table" (для возможности хранения нескольких элементов).

image::SC_CreateCard5.PNG[image]
+
В данную секцию требуется добавить следующие поля:

* Employee с типом refid, в котором содержится ссылка на сотрудника, выполнившего перемещение техники. В свойствах поля необходимо указать идентификаторы в полях *Тип, куда ссылаемся (ID)* (идентификатор _Справочника сотрудников_) и *Раздел, куда ссылаемся (ID)* (идентификатор секции _Сотрудники_). Дополнительно можно установить флажок *Обязательное*.
+
image::SC_CreateCard6.PNG[image]
* Date с типом date. Данное поле содержит дату перемещения оборудования.
+
image::SC_CreateCard7.PNG[image]
* Recipient с типом refid, в котором содержится ссылка на организацию/подразделение. В свойствах поля необходимо указать идентификаторы в полях *Тип, куда ссылаемся (ID)* (идентификатор _Справочника сотрудников_) и *Раздел, куда ссылаемся (ID)* (идентификатор секции _Подразделения_). Дополнительно можно установить флажок *Обязательное*.
+
image::SC_CreateCard8.PNG[image]
* Description с типом string. Тестовый комментарий к операции перемещения техники.
+
image::SC_CreateCard9.PNG[image]
. Добавить в карточку секции System, Numbers и Processes. Данные секции являются типовыми и могут быть скопированы (операции Copy и Paste из контекстного меню) из схемы карточки типа _Документ_ библиотеки _{bo}_. Если секции создаются методом копирования, необходимо изменить псевдоним секции на начальное значение.

После создания схемы, библиотека карточек должна быть загружена на сервер {dv} (см. раздел xref:solutions/cards/scheme/load-scheme.adoc[Загрузка схем карточек в базу данных]).

[IMPORTANT]
====
После добавления карточки потребуется перезапуск сервиса {dv} или перезагрузка сервера
====

== Установка параметров карточки в конструкторах

После добавления карточки в базу {dv} необходимо произвести дополнительную настройку карточки при помощи конструкторов Docsvision.

. В _Справочнике видов карточек_ откройте созданную библиотеку и карточку и проверите соответствие настроек представленному ниже изображению (название карточки и библиотеки может отличаться). Сохраните изменения.
+
image::SC_CreateCard10.PNG[image]
. В _Конструкторе разметок_ определите минимум одно состояние, которое будет являться начальным, а также установите доступность операций редактирования.
+
image::SC_CreateCard11.PNG[image]
. В _Конструкторе ролей_ определите роль для карточки (например, Все).
+
image::SC_CreateCard12.PNG[image]
+
Установите необходимый уровень доступа для роли к операциям с карточкой в разделе *Матрица доступа*.
+
image::SC_CreateCard13.PNG[image]
. В _Конструкторе разметок_ требуется создать разметку, соответствующую содержимому карточки.
+
image::SC_CreateCard14.PNG[image]
+
*Название* -- элемент управления типа _Строка_, *Источником данных* для которого установлена секция _Основная информация_, а *Поле данных* -- _Название_.

image::SC_CreateCard15.PNG[image]

В качестве элемента управления *Перемещение* используется _Таблица_, у которой *Источником данных* установлена секция _История перемещения_.

image::SC_CreateCard16.PNG[image]

Для данного элемента управления необходимо добавить столбцы: _Дата_, _Сотрудник_, _Получатель_ и _Примечание_. В каждом столбце выбирается соответствующий элемент данных.

image::SC_CreateCard17.PNG[image]

После сохранения всех настроек появится возможность создать экземпляр новой карточки и заполнить её данными.

image::SC_CreateCard18.PNG[image]
