= Раздел "Virtual fields"

После описания секций и полей карточки можно переходить к описанию _виртуальных полей_. Виртуальные поля представляют собой правила для формирования данных, которые физически не хранятся в самой карточке, но могут быть интересны при построении представлений (отчётов) с участием карточек такого типа.

.В качестве источника данных для виртуального поля могут выступать:
* Физическое поле самой карточки.
* Физическое поле карточки другого типа, которая по каким-то признакам связана с данной.
* Системные данные о карточке, например дата последнего изменения.
* Результат вычислений, произведённых над любым из вышеперечисленных полей.

[NOTE]
====
Виртуальные поля, определённые в схеме карточки, будут всегда доступны в рамках соответствующих секций в диалоге настройки представлений. Помимо этого, пользователи смогут самостоятельно доопределить дополнительные виртуальные поля уже в процессе работы с системой.
====

Для создания нового виртуального поля нужно перейти в раздел _Virtual fields_ и выбрать соответствующий пункт контекстного меню.

.Свойства виртуального поля
image::virtual-field-properties.png[Свойства виртуального поля]

.Основные свойства виртуального поля:
* _Псевдоним_ -- псевдоним виртуального поля, с помощью которого к нему можно обращаться в коде. Псевдоним должен быть уникальным в рамках карточки.
* _Названия_ -- локализованные названия виртуального поля, отображаемые у пользователя (в диалоге настройки представлений).
* _Description_ -- словесное описание виртуального поля, будет отображаться в виде подсказки к полю в диалогах поиска и представлений.
* _Идентификатор_ -- уникальный идентификатор виртуального поля.
* _Тип_ -- результирующий тип данных виртуального поля.
+
.Доступны только простые типы:
** _int_ -- целое.
** _bool_ -- булевское значение.
** _datetime_ -- дата и время.
** _uniqueid_ -- уникальный идентификатор (`GUID`).
** _string_ -- строка.
** _unistring_ -- строка в формате Unicode.
** _float_ -- число с плавающей точкой.
** _unitext_ -- текст в формате Unicode.
** _decimal_ -- десятичное число.
** _binary_ -- двоичные данные.
* Идентификатор секции, на основе данных которой строится виртуальное поле. Из этой секции будут выбираться физические поля для вычислений, и к ней будут последовательно присоединяться другие секции или таблицы.
* _Определение поля_ -- источник данных для виртуального поля.
+
.Доступные источники:
** _Поле секции_ -- физическое поле основной или присоединённой секции.
** _Вычисляемое поле_ -- правила вычислений над физическим полем основной или присоединённой секции.
* _Присоединенные разделы_ -- позволяет определить связи основной секции виртуального поля с другими секциями или таблицами. Секции связываются между собой по определённому полю (обычно -- уникальному идентификатору).

.Присоединение секции
image::append-section.png[Присоединение секции]

.При присоединении секции, необходимо указать следующие значения:
* _Alias_ -- уникальный (в рамках определения виртуального поля) псевдоним присоединяемой секции.
* _Source section_ -- секция, к которой производится присоединение (основная секция виртуального поля или ранее присоединенная).
* _Source field_ -- поле оригинальной секции, по которому производится присоединение (`JOIN`).
* _Target section_ -- секция другой карточки или системная таблица.
* _Target field_ -- поле присоединяемой секции, по которому производится `JOIN`.
* _Conditions_ -- условия фильтрации записей присоединённой секции.

После присоединения всех необходимых секций можно задать правила построения вычисляемых полей. Для чего кликните по кнопке *Изменить* в блоке настроек поля.

.Свойства вычисляемого поля
image::calculated-field-properties.png[Свойства вычисляемого поля]

Описание вычисляемого поля по сути представляет собой совокупность атомарных операций (элементов), выполняющихся в определённом порядке, который задаётся через иерархические группы. Внутри каждой группы элементы могут объединяться арифметической операцией (`+`, `-`, `*`, `/`), логической операцией (`AND`, `OR`) или агрегацией.

[IMPORTANT]
====
Вычисления одного уровня исполняются строго последовательно, поэтому важно контролировать порядок их выполнения. Для этого можно перемещать элементы внутри группы кнопками *Up* и *Down*.
====

.Каждый элемент вычислений, в свою очередь, может быть одним из следующих видов:
* _Simple_ -- значение физического поля секции, предопределённое значение или результат применения к нему простейшей функции.
+
.Элемент вычисления вида "Simple"
image::calculation-simple.png[Элемент вычисления вида "Simple"]
+
* _Switch_ -- результат селекции, сопоставляющей конкретным данным физического поля предопределённые значения.
+
.Элемент вычисления вида "Switch"
image::calculation-switch.png[Элемент вычисления вида "Switch"]
+
* _Conditions_ -- условный оператор, формирующий значение элемента в зависимости от значений других элементов.
+
.Элемент вычисления вида "Conditions"
image::calculation-conditions.png[Элемент вычисления вида "Conditions"]
+

[CAUTION]
====
Важно контролировать типы конкретных элементов вычислений и их групп, чтобы избежать ошибок в вычислениях и получить правильный тип результирующего значения.
====
