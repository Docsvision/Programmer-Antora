= Взаимодействие с системной карточкой доверенности

Системная карточка для работы с машиночитаемой доверенностью (далее - МЧД или доверенность) -- это карточка без UI. Полное название карточки: _Системная карточка доверенности_. Сокращение: СКД.

.Жизненный цикл машиночитаемой доверенности в {dv}
image::ROOT:attorney.png[Жизненный цикл машиночитаемой доверенности в {dv}]

Доступ к СКД разграничивается дискреционной моделью безопасности. По умолчанию у всех пользователей есть право на чтение СКД.

Разработчик может установить связь СКД с родительской ПКД. При этом в СКД будут применены ролевые права родительской карточки.

.Для работы с СКД предназначены:
[lowerroman]
.. Классы:
+
** `xref:.BackOffice-ObjectModel-Powers:PowerOfAttorney_CL.adoc[PowerOfAttorney]` -- системная карточка доверенности.
** `xref:.BackOffice-ObjectModel-Powers:PowerOfAttorneyMainInfo_CL.adoc[PowerOfAttorneyMainInfo]` -- представляет секцию "Основная информация" системной карточки доверенности.
** `xref:.BackOffice-ObjectModel-Powers:PowerOfAttorneyRepresentative_CL.adoc[PowerOfAttorneyRepresentative]` -- представляет секцию "Представитель" системной карточки доверенности.
** `xref:.BackOffice-ObjectModel-Powers:PowerOfAttorneyRepresentativesPowers_CL.adoc[PowerOfAttorneyRepresentativesPowers]` -- представляет секцию "Полномочия" системной карточки доверенности.
** `xref:.BackOffice-ObjectModel-Powers:PowerOfAttorneySubsidiaryPowersOfAttorney_CL.adoc[PowerOfAttorneySubsidiaryPowersOfAttorney]` -- представляет cекции "Системные карточки" дочерних доверенностей.
** `xref:.BackOffice-ObjectModel-Powers:Powers_CL.adoc[Powers]`  -- представляет полномочия для справочника полномочий МЧД.
** `xref:.BackOffice-ObjectModel-Powers:PowersCode_CL.adoc[PowersCode]` -- представляет коды полномочий для справочника полномочий МЧД.
** `xref:.BackOffice-ObjectModel-Powers:PowersGroup_CL.adoc[PowersGroup]` -- представляет группы полномочий для справочника полномочий МЧД.
** `xref:.BackOffice-ObjectModel-Powers:PowersPowerOfAttorneyFormat_CL.adoc[PowersPowerOfAttorneyFormat]` -- представляет типы доверенности карточки справочник полномочий МЧД.
** `xref:BackOffice-ObjectModel-Services-IPartnersService:.IPowerOfAttorneyMachineReadableProvider_IN.adoc[IPowerOfAttorneyMachineReadableProvider]` -- определяет методы формирования и чтения машиночитаемой доверенности.
** `xref:BackOffice-ObjectModel-Services-IPartnersService:IPartnersService_IN.adoc[IPowerOfAttorneyService]` -- предоставляет методы для работы с системной карточкой доверенности.
+
.. Перечисления::
+
** `xref:.BackOffice-ObjectModel-Powers:PowerOfAttorneyRegTransferStatuses_EN.adoc[PowerOfAttorneyRegTransferStatuses]` -- статус передачи доверенности в распределённый реестр ФНС.
** `xref:.BackOffice-ObjectModel-Powers:PowerOfAttorneyRetrustType_EN.adoc[PowerOfAttorneyRetrustType]` -- признак возможности оформления передоверия.
** `xref:.BackOffice-ObjectModel-Powers:PowerOfAttorneySignatureFormat_EN.adoc[PowerOfAttorneySignatureFormat]` -- формат подписи.
** `xref:.BackOffice-ObjectModel-Powers:PowerOfAttorneyStatus_EN.adoc[PowerOfAttorneyStatus]` -- статус доверенности.

[#user-card]
== Пользовательская карточка доверенности

Также может быть разработана _Пользовательская карточка доверенности_, имеющая UI. ПКД настраивается в проектах администратором.

== Форматы хранения МЧД

Система хранит различные форматы МЧД:

* Формат единой формы МЧД.
* Формат МЧД, подтверждающей полномочия представителя налогоплательщика.
* Собственные разрабатываемые форматы.

Стандартные форматы указаны в _Справочнике полномочий_, см. например, xref:.BackOffice-ObjectModel-Powers:PowersCode_CL.adoc[].

[#submission]
== Передача СКД в реестр

СКД, сформированная в формате ФНС передаётся в распределённый реестр ФНС. Статус записывается в поле СКД:

 * `0` -- не передавалась.
 * `1` -- передана на регистрацию.
 * `2` -- зарегистрирована.
 * `3` -- передан запрос на отзыв.
 * `4` -- отозвана.

[#sbsidiary]
== Передоверие

Доверенность может быть оформлена с возможностью формирования СКД передоверия:

* С однократным передоверием -- доверенность может быть передоверена один раз.
* С последующим передоверием -- доверенность может быть передоверена неограниченное число раз.
* Без передоверия -- доверенность не может быть передоверена.

После успешного формирования файла передоверия в его СКД заполняется поле "родительская доверенность".

При экспорте МЧД сохраняется вся цепочка МЧД -- xml-файлы и файлы подписей к ним.

[#web]
== Пример работы из {wc}а

См. подробнее xref:webclient:programmer:other/powers-of-attorney.adoc[документацию по разработке web-решений].
