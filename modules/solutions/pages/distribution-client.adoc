= Инсталляция клиентской части решения

Для корректной работы разработанного решения на клиентских компьютерах там должны быть установлены и зарегистрированы компоненты карточек, библиотеки карточек, а также всех вспомогательных библиотек, использованных при разработке.

Платформа {dv} предусматривает их автоматическую установку при первом обращении к серверу {dv} при помощи специализированной программы инсталляции в формате Windows Installer (MSI), которую также должен создать разработчик решения.

Создать инсталляционный MSI-файл можно при помощи специализированных приложений, предназначенных для создания программ инсталляции. Например, это может InstallShield (Windows Installer Edition), либо можно воспользоваться средствами подготовки инсталляций в составе Microsoft Visual Studio (2003 или 2005). В процессе создания MSI-файла в него нужно включить компонент библиотеки и компонент(ы) карточек. Для всех COM-компонентов следует указать на необходимость их регистрации (extract-at-build или self-register).

.В процессе создания инсталляционного пакета необходимо указать следующие его параметры:
* Название, описание, производитель.
* Версия, желательно, чтобы она совпадала с версией библиотеки карточек.
* Код продукта (`ProductCode`) -- уникальный код инсталляционного пакета (будет сгененрирован автоматически).
* Базовый путь для установки файлов.

[#paths]
Путь для установки файлов обычно зависит от выбранной области установки. При установке "Только для текущего пользователя" это обычно путь: `$\КАТАЛОГ_ПРОФИЛЯ_ПОЛЬЗОВАТЕЛЯ\Local Settings\DocsVision\РЕШЕНИЕ\ВЕРСИЯ\Client\`, а при установке в область "Для всех пользователей" -- путь: `$\Program Files\DocsVision\РЕШЕНИЕ}\Client\`.

[WARNING]
====
Особенность работы Windows Installer такова, что даже при установке в режиме "только для текущего пользователя", ключи реестра для библиотек типов (_TypeLib_) будут создаваться в общей ветке реестра ({hklm}).

В случае отсутствия у пользователя административных привилегий на компьютере, это может привести к ошибкам в процессе установки и некорректному функционированию решения. Для избежания подобных ошибок желательно отказаться от регистрации библиотек типов (если они не нужны) -- для этого нужно проследить, чтобы в таблице _TypeLib_ инсталляционного пакета не было никаких записей.
====

После создания инсталляционного пакета его необходимо сопоставить с библиотекой карточек. Это делается при помощи утилиты "CardManager" -- в описании библиотеки на вкладке _Installers_:

.Вкладка "Installers"
image::ROOT:installers-tab.png[Вкладка "Installers"]

Поле _PackageID_ (значение генерируется автоматически) содержит уникальный идентификатор данной программы инсталляции (у библиотеки может быть несколько инсталляционных программ). В поле _ProductCode_ необходимо скопировать идентификатор программы установки, сгенерированный при её создании, а в поле _Installer_ -- имя файла с относительным путем, по которому на сервере будет расположен инсталляционный пакет.

Готовый клиентский инсталляционный пакет необходимо расположить на сервере (вручную или при помощи программы инсталляции серверной части решения), где он будет доступен для скачивания и установки всем клиентам (см. <<paths,выше>>).

При обновлении версии решения на сервере клиентские компоненты будут обновлены на новую версию автоматически после первого обращения клиента к обновленному серверу.

[WARNING]
====
Для корректного обновления решения на клиентских машинах при изменении версии на сервере в инсталляционном пакете новой версии решения необходимо сгенерировать новый _ProductCode_, но оставить прежнее значение _UpgradeCode_.
====
